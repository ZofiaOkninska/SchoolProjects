<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Lekcja 3 - 2</title>
  <style>
  #main {
    position: relative;
    top: 100px;
    left: 50px;
  }

  .block {
    width: 50px;
    height: 50px;
    position: absolute;
    left: 0px;
    top: 0px;
    border: 2px solid black;
    background-color: lightblue;
  }

  #player1 {
    position: absolute;
    top:300px;
  }

  #player2 {
    position: absolute;
    top:300px;
    left:50px;
  }
  </style>
  <script src="../libs/jq.min.js"></script>
  <script>
  $(document).ready(function () {
    var route = [];
    var movePlayer1Position, movePlayer2Position;

    for (var i = 0; i < 5; i++) {
      for (var j = 0; j < 5; j++) {
        var div = $('<div>')
        .addClass("block")
        .css("left", (j * 50) + "px")
        .css("top", (i * 50) + "px")
        $("#main").append(div)
      }
    }

    function movePlayer1 (i) {
      $("#player1").css({
        "top" : 3 + route[i].top,
        "left" : 3 + route[i].left,
      });
    }

    function movePlayer2 (i) {
      $("#player2").css({
        "top" : 3 + route[i].top,
        "left" : 3 + route[i].left,
      });
    }

    $(".block").on("click", function () {
      $(this).css("backgroundColor", "white")
      var blockPosition = $(this).position();
      route.push(blockPosition)
      console.log(route)
    })

    $("#startGame").on("click", function () {
      movePlayer1Position  = 0;
      movePlayer2Position  = route.length - 1;

      if (route.length == 0) {
        alert("Too short route.")
      } else {
        $("#player1").css({
          "top" : 3 + route[movePlayer1Position].top,
          "left" : 3 + route[movePlayer1Position].left,
          "zIndex" : 2
        });
        $("#player2").css({
          "top" : 3 + route[movePlayer2Position].top,
          "left" : 3 + route[movePlayer2Position].left,
          "zIndex" : 2
        });
      }
    }
  )

  var check = 2;
  var reverseDirection = false;

  $("#nexMove").on("click", function () {
    if (!reverseDirection) {
      if (movePlayer2Position - movePlayer1Position > 1) {
        if (check%2 == 0) {
          movePlayer1Position++
          movePlayer1(movePlayer1Position)
        } else {
          movePlayer2Position--
          movePlayer2(movePlayer2Position)
        }
        check++
        console.log(movePlayer1Position, movePlayer2Position)
      } else if (movePlayer2Position - movePlayer1Position === 1) {
        reverseDirection = true
      }
    }

    if (reverseDirection) {
      console.log("rev")
      if (movePlayer2Position - movePlayer1Position < route.length - 1) {
        if (check%2 == 0) {
          movePlayer1Position--
          movePlayer1(movePlayer1Position)
        } else {
          movePlayer2Position++
          movePlayer2(movePlayer2Position)
        }
        check++
        console.log(movePlayer1Position, movePlayer2Position)
      } else if (movePlayer2Position - movePlayer1Position === route.length - 1) {
        reverseDirection = false
      }
    }
  })

  $("#resetGame").on("click", function () {
    $(".block").css("backgroundColor", "lightblue")
    $("#player1").css({
      "top" : 300,
      "left": 0});
    $("#player2").css({
      "top" : 300,
      "left": 50});
    route = [];
    console.log(route)
    reverseDirection = false
      })
    })
    </script>
  </head>

  <body>
    <button id="startGame">START GAME</button>
    <button id="nexMove">NEXT MOVE</button>
    <button id="resetGame">RESET GAME</button>

    <div id="main">
      <div id="player1"><img src="player1.png"></div>
      <div id="player2"><img src="player2.png"></div>
    </div>
  </body>

  </html>
